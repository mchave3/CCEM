name: ðŸ“‹ GitHub Summary

on:
  workflow_call:
    inputs:
      version:
        description: 'Version string (e.g., 2510.1 or 2510-Beta.1)'
        required: true
        type: string
      msix-version:
        description: '4-part MSIX version (e.g., 25.10.1.0)'
        required: true
        type: string
      tag-name:
        description: 'Git tag name (e.g., v2510.1)'
        required: true
        type: string
      release-channel:
        description: 'Release channel (stable or beta)'
        required: true
        type: string
      release-url:
        description: 'URL of the GitHub Release'
        required: true
        type: string
      source-commit:
        description: 'Source commit SHA'
        required: true
        type: string

jobs:
  summary:
    name: Generate Summary
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: pwsh
    steps:
      - name: Generate comprehensive summary
        run: |
          $timestamp = (Get-Date).ToUniversalTime().ToString("yyyy-MM-dd HH:mm:ss UTC")

          $summary = @"
          # ðŸŽ‰ Release Summary

          ## ðŸ“¦ Release Information
          | Property | Value |
          |----------|-------|
          | **Version** | ``${{ inputs.version }}`` |
          | **MSIX Version** | ``${{ inputs.msix-version }}`` |
          | **Tag** | ``${{ inputs.tag-name }}`` |
          | **Channel** | ``${{ inputs.release-channel }}`` |
          | **Commit** | ``${{ inputs.source-commit }}`` |

          ## ðŸ”— Links
          * **Release Page**: ${{ inputs.release-url }}
          * **Repository**: https://github.com/${{ github.repository }}
          * **Workflow Run**: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

          ## âœ… Workflow Status
          All steps completed successfully! ðŸš€

          ---
          *Generated on $timestamp*
          "@

          $summary | Out-File -FilePath $env:GITHUB_STEP_SUMMARY -Append -Encoding utf8

      - name: Create job summary badges
        run: |
          Write-Host "## ðŸ† Build Badges" >> $env:GITHUB_STEP_SUMMARY
          Write-Host "" >> $env:GITHUB_STEP_SUMMARY
          Write-Host "![Version](https://img.shields.io/badge/version-${{ inputs.version }}-blue?style=for-the-badge)" >> $env:GITHUB_STEP_SUMMARY
          Write-Host "![Channel](https://img.shields.io/badge/channel-${{ inputs.release-channel }}-green?style=for-the-badge)" >> $env:GITHUB_STEP_SUMMARY
          Write-Host "![Status](https://img.shields.io/badge/status-released-success?style=for-the-badge)" >> $env:GITHUB_STEP_SUMMARY
