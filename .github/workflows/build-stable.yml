name: Build Stable Release

on:
  workflow_dispatch:
    inputs:
      branch:
        description: Branch to release from
        required: false
        default: main
        type: string

permissions:
  contents: write

jobs:
  derive_version:
    name: "ðŸ§® Derive Stable Version"
    uses: ./.github/workflows/versioning.yml
    with:
      release_type: stable

  build_and_publish:
    name: "ðŸš¢ Build and Publish Stable Release"
    needs:
      - derive_version
    uses: ./.github/workflows/build-and-publish.yml
    with:
      branch: ${{ inputs.branch }}
      version: ${{ needs.derive_version.outputs.version }}
      msix_version: ${{ needs.derive_version.outputs.msix_version }}
      tag: ${{ needs.derive_version.outputs.tag }}
      channel: ${{ needs.derive_version.outputs.channel }}
      prerelease: false
      release_name: ${{ needs.derive_version.outputs.release_name }}
      make_latest: "true"
    secrets:
      release_token: ${{ secrets.GITHUB_TOKEN }}
